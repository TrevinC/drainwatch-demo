<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DrainWatch - Climate-Resilient Stormwater Monitoring</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="./Drain Watch Logo.png" type="image/png">
    <style>
        @keyframes blink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.3; }
        }
        .animate-blink {
            animation: blink 2s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Brand colors
        const BRAND_COLORS = {
            primary: '#005c89',
            dark: '#00264b',
            light: '#bbc9cd'
        };

        // User credentials
        const USERS = {
            'Grainger': { password: 'IIT', role: 'dashboard', name: 'Grainger' },
            'Flume': { password: 'IIT', role: 'flume', name: 'Flume' },
            'Wabash': { password: 'IIT', role: 'wabash', name: 'Wabash' }
        };

        // Icons
        const AlertTriangle = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
        );

        const TrendingUp = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} points="23 6 13.5 15.5 8.5 10.5 1 18" />
                <polyline strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} points="17 6 23 6 23 12" />
            </svg>
        );

        const CheckCircle = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const LogOut = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
            </svg>
        );

        const Activity = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} points="22 12 18 12 15 21 9 3 6 12 2 12" />
            </svg>
        );

        const Battery = ({ className, level }) => {
            const fillWidth = Math.max(0, Math.min(100, level));
            const color = level > 50 ? 'text-green-500' : level > 20 ? 'text-yellow-500' : 'text-red-500';
            
            return (
                <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <rect x="2" y="7" width="18" height="10" rx="1" strokeWidth="2" />
                    <rect x="3.5" y="8.5" width={fillWidth * 0.15} height="7" fill="currentColor" className={color} />
                    <path d="M20 10h2v4h-2" strokeWidth="2" />
                </svg>
            );
        };

        // Sensor coordinates
        const sensorData = [
            { id: 'S-001', name: 'State & E 33rd St', status: 'normal', capacity: 52, flow: 27, headHeight: 2.1, x: 58, y: 45, battery: 88 },
            { id: 'S-002', name: 'Michigan & E 31st St', status: 'warning', capacity: 78, flow: 28, headHeight: 3.2, x: 78, y: 25, battery: 84 },
            { id: 'S-003', name: 'Federal & E 33rd St', status: 'normal', capacity: 45, flow: 22, headHeight: 1.8, x: 68, y: 45, battery: 85 },
            { id: 'S-004', name: 'Indiana & E 34th St', status: 'normal', capacity: 38, flow: 23, headHeight: 1.5, x: 83, y: 55, battery: 17 },
            { id: 'S-005', name: 'State & E 35th St', status: 'warning', capacity: 71, flow: 35, headHeight: 2.9, x: 58, y: 65, battery: 79 },
            { id: 'S-006', name: 'Michigan & E 32nd St', status: 'normal', capacity: 28, flow: 21, headHeight: 1.1, x: 78, y: 35, battery: 67 },
            { id: 'S-007', name: 'MLK & E 31st St', status: 'critical', capacity: null, flow: null, headHeight: null, x: 92, y: 25, battery: 0, error: true },
            { id: 'S-008', name: 'State & E 34th St', status: 'normal', capacity: 42, flow: 26, headHeight: 1.7, x: 58, y: 55, battery: 88 },
            { id: 'S-009', name: 'Federal & E 32nd St', status: 'normal', capacity: 35, flow: 23, headHeight: 1.4, x: 68, y: 35, battery: 73 },
            { id: 'S-010', name: 'Indiana & E 35th St', status: 'normal', capacity: 29, flow: 20, headHeight: 1.2, x: 83, y: 65, battery: 81 },
            { id: 'S-011', name: 'Michigan & E 34th St', status: 'normal', capacity: 33, flow: 25, headHeight: 1.3, x: 78, y: 55, battery: 56 },
            { id: 'S-012', name: 'State & E 31st St', status: 'normal', capacity: 40, flow: 27, headHeight: 1.6, x: 58, y: 25, battery: 94 },
            { id: 'S-013', name: 'Federal & E 34th St', status: 'normal', capacity: 36, flow: 22, headHeight: 1.5, x: 68, y: 55, battery: 89 },
            { id: 'S-014', name: 'MLK & E 33rd St', status: 'normal', capacity: 31, flow: 19, headHeight: 1.2, x: 92, y: 45, battery: 76 },
            { id: 'S-015', name: 'Michigan & E 35th St', status: 'normal', capacity: 44, flow: 29, headHeight: 1.8, x: 78, y: 65, battery: 15 },
            { id: 'S-016', name: 'Federal & E 31st St', status: 'normal', capacity: 37, flow: 21, headHeight: 1.5, x: 68, y: 25, battery: 83 },
        ];
        
        // *** WORK ORDER FIX: Y-coordinates shifted vertically into streets ***
        const workOrders = [
            // This one STAYS on the sensor, since it's a sensor error
            { id: 'WO-2401', location: 'MLK & E 31st St', risk: 'critical', issue: 'Sensor error detected', impact: 'High', eta: '1 day', x: 92, y: 25 }, 
            // These are moved vertically into the "street"
            { id: 'WO-2402', location: 'Near Michigan & 32nd', risk: 'critical', issue: 'Partial blockage detected', impact: 'High', eta: '2 days', confidence: 91, x: 78, y: 30 },
            { id: 'WO-2403', location: 'Near Federal & 34th', risk: 'high', issue: 'Debris accumulation', impact: 'Medium', eta: '3 days', confidence: 89, x: 68, y: 50 },
            { id: 'WO-2404', location: 'Near Indiana & 35th', risk: 'high', issue: 'Debris accumulation', impact: 'High', eta: '2 days', confidence: 87, x: 83, y: 60 },
            { id: 'WO-2405', location: 'Near State & 34th', risk: 'medium', issue: 'Reduced flow capacity', impact: 'Low', eta: '5 days', confidence: 78, x: 58, y: 50 },
        ];

        // Calculate average capacity from working sensors for historical trend
        const workingSensors = sensorData.filter(s => !s.error);
        const avgCapacity = workingSensors.reduce((sum, s) => sum + s.capacity, 0) / workingSensors.length;
        
        const historicalData = [
            { time: '00:00', capacity: Math.round(avgCapacity * 0.38), flow: 22 },
            { time: '04:00', capacity: Math.round(avgCapacity * 0.46), flow: 26 },
            { time: '08:00', capacity: Math.round(avgCapacity * 0.63), flow: 32 },
            { time: '12:00', capacity: Math.round(avgCapacity * 0.74), flow: 37 },
            { time: '16:00', capacity: Math.round(avgCapacity * 0.86), flow: 39 },
            { time: '20:00', capacity: Math.round(avgCapacity * 0.93), flow: 38 },
            { time: 'Now', capacity: Math.round(avgCapacity), flow: 40 },
        ];

        const performanceData = [
            { metric: 'Incidents Prevented', value: '127', change: '+82%', trend: 'up' },
            { metric: 'Flooding Events', value: '3', change: '-67%', trend: 'down' },
            { metric: 'Maintenance Cost', value: '$42K', change: '-38%', trend: 'down' },
            { metric: 'CSO Volume Reduction', value: '220M gal', change: '-32%', trend: 'down' },
        ];

        // New SimpleLineChart Component
        const SimpleLineChart = ({ data }) => {
            // Y-AXIS FIX: Set maxValue to 100 and minValue to 0 for a 0-100% scale
            const maxValue = 100;
            const minValue = 0;
            const range = maxValue - minValue;

            // Define chart padding/area
            const padding = { top: 10, right: 5, bottom: 20, left: 12 };
            const chartWidth = 100 - padding.left - padding.right;
            const chartHeight = 100 - padding.top - padding.bottom;

            // Function to get X position for an index
            const getX = (i) => {
                return padding.left + (i / (data.length - 1)) * chartWidth;
            };

            // Function to get Y position for a value
            const getY = (value) => {
                if (range === 0) return padding.top;
                return padding.top + (1 - (value - minValue) / range) * chartHeight;
            };

            const points = data.map((d, i) => `${getX(i)},${getY(d.capacity)}`).join(' ');

            // Create Y-axis labels (0%, 25%, 50%, 75%, 100%)
            const yAxisLabels = [0, 0.25, 0.5, 0.75, 1].map(pct => {
                const value = Math.round(maxValue * pct); 
                const y = getY(value);
                return { value: `${value}%`, y };
            });

            return (
                // *** HEIGHT FIX: Increased container height to h-72 ***
                <div className="relative h-72 bg-gray-50 rounded-lg p-4">
                    <div className="text-sm font-semibold mb-2">System Capacity Trend</div>
                    {/* *** HEIGHT FIX: Increased SVG height to h-64 *** */}
                    <svg className="w-full h-64" viewBox="0 0 100 100">
                        {/* Y-axis labels and grid lines */}
                        {yAxisLabels.map((label, i) => (
                            <g key={i}>
                                <text x={padding.left - 2} y={label.y} fontSize="5" fill="#666" textAnchor="end" dominantBaseline="middle">
                                    {label.value}
                                </text>
                                <line
                                    x1={padding.left} y1={label.y}
                                    x2={padding.left + chartWidth} y2={label.y}
                                    stroke="#e5e7eb" strokeWidth="0.3"
                                />
                            </g>
                        ))}
                        
                        {/* X-axis labels */}
                        {data.map((d, i) => (
                            <text
                                key={d.time}
                                x={getX(i)}
                                y={100 - padding.bottom + 7} // Position below the chart
                                fontSize="5"
                                fill="#666"
                                textAnchor="middle"
                            >
                                {d.time}
                            </text>
                        ))}

                        {/* X-axis line */}
                        <line 
                            x1={padding.left} y1={getY(0)}
                            x2={padding.left + chartWidth} y2={getY(0)}
                            stroke="#666" strokeWidth="0.5"
                        />
                        {/* Y-axis line */}
                        <line 
                            x1={padding.left} y1={padding.top}
                            x2={padding.left} y2={getY(0)}
                            stroke="#666" strokeWidth="0.5"
                        />

                        {/* Data Line */}
                        <polyline
                            points={points}
                            fill="none"
                            stroke="#ef4444"
                            strokeWidth="1.5"
                        />
                        
                        {/* Data Points */}
                        {data.map((d, i) => (
                            <circle
                                key={i}
                                cx={getX(i)}
                                cy={getY(d.capacity)}
                                r="1.5"
                                fill="#ef4444"
                            />
                        ))}
                    </svg>
                </div>
            );
        };

        // New SimpleBarChart Component
        const SimpleBarChart = ({ data }) => {
            const maxValue = Math.max(...data.map(d => d.flow));

            // Define chart padding/area
            const padding = { top: 10, right: 5, bottom: 20, left: 12 };
            const chartWidth = 100 - padding.left - padding.right;
            const chartHeight = 100 - padding.top - padding.bottom;

            // Bar calculations
            const barWidth = (chartWidth / data.length) * 0.8; // 80% width for padding
            const barSpacing = (chartWidth / data.length) * 0.2;

            // Function to get Y position for a value
            const getY = (value) => {
                if (maxValue === 0) return padding.top + chartHeight;
                return padding.top + (1 - value / maxValue) * chartHeight;
            };

            // Create Y-axis labels
            const yAxisLabels = [0, 0.25, 0.5, 0.75, 1].map(pct => {
                const value = Math.round(maxValue * pct);
                const y = getY(value);
                return { value, y };
            });
            
            return (
                // *** HEIGHT FIX: Increased container height to h-72 ***
                <div className="relative h-72 bg-gray-50 rounded-lg p-4">
                    <div className="text-sm font-semibold mb-2">Flow Rate Analysis (L/s)</div>
                    {/* *** HEIGHT FIX: Increased SVG height to h-64 *** */}
                    <svg className="w-full h-64" viewBox="0 0 100 100">
                        {/* Y-axis labels and grid lines */}
                        {yAxisLabels.map((label, i) => (
                            <g key={i}>
                                <text x={padding.left - 2} y={label.y} fontSize="5" fill="#666" textAnchor="end" dominantBaseline="middle">
                                    {label.value}
                                </text>
                                <line
                                    x1={padding.left} y1={label.y}
                                    x2={padding.left + chartWidth} y2={label.y}
                                    stroke="#e5e7eb" strokeWidth="0.3"
                                />
                            </g>
                        ))}
                        
                        {/* X-axis labels */}
                        {data.map((d, i) => {
                            // X-AXIS FIX: Only show every other label (i % 2 === 0)
                            if (i % 2 !== 0) return null; 

                            const x = padding.left + i * (barWidth + barSpacing) + (barWidth / 2) + (barSpacing / 2);
                            return (
                                <text
                                    key={d.time}
                                    x={x}
                                    y={100 - padding.bottom + 7} // Position below the chart
                                    fontSize="5"
                                    fill="#666"
                                    textAnchor="middle"
                                >
                                    {d.time}
                                </text>
                            );
                        })}
                        
                        {/* X-axis line */}
                        <line 
                            x1={padding.left} y1={getY(0)}
                            x2={padding.left + chartWidth} y2={getY(0)}
                            stroke="#666" strokeWidth="0.5"
                        />
                        {/* Y-axis line */}
                        <line 
                            x1={padding.left} y1={padding.top}
                            x2={padding.left} y2={getY(0)}
                            stroke="#666" strokeWidth="0.5"
                        />

                        {/* Bars */}
                        {data.map((d, i) => {
                            const x = padding.left + i * (barWidth + barSpacing) + (barSpacing / 2);
                            const y = getY(d.flow);
                            const height = getY(0) - y;

                            return (
                                <rect
                                    key={d.time}
                                    x={x}
                                    y={y}
                                    width={barWidth}
                                    height={height}
                                    className="fill-blue-500 transition-all hover:fill-blue-600"
                                >
                                    <title>{`${d.time}: ${d.flow} L/s`}</title>
                                </rect>
                            );
                        })}
                    </svg>
                </div>
            );
        };

        // Login Component with brand colors
        const LoginPage = ({ onLogin }) => {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [showCredentials, setShowCredentials] = useState(false);

            const handleSubmit = (e) => {
                e.preventDefault();
                setError('');

                const user = USERS[username];
                if (user && user.password === password) {
                    onLogin({ username, ...user });
                } else {
                    setError('Invalid username or password');
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-4" style={{background: `linear-gradient(to bottom right, ${BRAND_COLORS.primary}, ${BRAND_COLORS.dark})`}}>
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md p-8">
                        <div className="text-center mb-8">
                            <div className="flex items-center justify-center mb-4">
                                <img src="./Drain Watch Logo.png" alt="DrainWatch Logo" className="h-16" onError={(e) => {
                                    e.target.style.display = 'none';
                                    e.target.nextSibling.style.display = 'block';
                                }} />
                                <svg style={{display: 'none'}} className="w-16 h-16" fill="none" stroke={BRAND_COLORS.primary} viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z" />
                                </svg>
                            </div>
                            <h1 className="text-3xl font-bold text-gray-800">DrainWatch</h1>
                            <p className="text-gray-600 mt-2">Climate-Resilient Infrastructure Operations</p>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Username</label>
                                <input
                                    type="text"
                                    value={username}
                                    onChange={(e) => setUsername(e.target.value)}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent"
                                    style={{focusRingColor: BRAND_COLORS.primary}}
                                    placeholder="Enter username"
                                    required
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent"
                                    placeholder="••••••••"
                                    required
                                />
                            </div>

                            {error && (
                                <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                                    {error}
                                </div>
                            )}

                            <button
                                type="submit"
                                className="w-full text-white font-semibold py-3 rounded-lg transition duration-200"
                                style={{backgroundColor: BRAND_COLORS.primary}}
                                onMouseOver={(e) => e.target.style.backgroundColor = BRAND_COLORS.dark}
                                onMouseOut={(e) => e.target.style.backgroundColor = BRAND_COLORS.primary}
                            >
                                Sign In
                            </button>
                        </form>

                        <div className="mt-6">
                            <button
                                onClick={() => setShowCredentials(!showCredentials)}
                                className="text-sm underline"
                                style={{color: BRAND_COLORS.primary}}
                            >
                                {showCredentials ? 'Hide' : 'Show'} Demo Credentials
                            </button>

                            {showCredentials && (
                                <div className="mt-4 rounded-lg p-4 text-xs space-y-2" style={{backgroundColor: BRAND_COLORS.light}}>
                                    <div className="font-semibold text-gray-700 mb-2">Available Logins:</div>
                                    <div><span className="font-medium">Grainger -</span>Password : IIT</div>
                                    <div><span className="font-medium">Flume -</span>Password : IIT</div>
                                    <div><span className="font-medium">Wabash -</span>Password : IIT</div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Header Component with brand colors
        const DashboardHeader = ({ user, onLogout }) => {
            return (
                // Header color fix from before
                <header className="text-white shadow-lg bg-sky-600">
                    <div className="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center space-x-3">
                                <img src="./Drain Watch Logo.png" alt="DrainWatch Logo" className="h-8" onError={(e) => {
                                    e.target.style.display = 'none';
                                    e.target.nextSibling.style.display = 'flex';
                                }} />
                                <svg style={{display: 'none'}} className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z" />
                                </svg>
                                <div>
                                    <h1 className="text-2xl font-bold">DrainWatch</h1>
                                    <p className="text-sm" style={{color: BRAND_COLORS.light}}>Climate-Resilient Infrastructure Operations</p>
                                </div>
                            </div>
                            <div className="flex items-center space-x-4">
                                <div className="text-right">
                                    <p className="text-sm font-medium">{user.name}</p>
                                </div>
                                <button
                                    onClick={onLogout}
                                    className="flex items-center space-x-2 px-4 py-2 rounded-lg transition"
                                    style={{backgroundColor: BRAND_COLORS.dark}}
                                    onMouseOver={(e) => e.target.style.opacity = '0.9'}
                                    onMouseOut={(e) => e.target.style.opacity = '1'}
                                >
                                    <LogOut className="w-4 h-4" />
                                    <span>Logout</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </header>
            );
        };

        // Grainger Dashboard
        const GraingerDashboard = ({ user, onLogout }) => {
            const [selectedSensor, setSelectedSensor] = useState(null);

            const getStatusColor = (status) => {
                switch (status) {
                    case 'critical': return 'bg-red-500';
                    case 'warning': return 'bg-yellow-500';
                    case 'normal': return 'bg-green-500';
                    default: return 'bg-gray-500';
                }
            };

            const getRiskColor = (risk) => {
                switch (risk) {
                    case 'critical': return 'bg-red-100 text-red-800 border-red-300';
                    case 'high': return 'bg-orange-100 text-orange-800 border-orange-300';
                    case 'medium': return 'bg-yellow-100 text-yellow-800 border-yellow-300';
                    default: return 'bg-blue-100 text-blue-800 border-blue-300';
                }
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    <DashboardHeader user={user} onLogout={onLogout} />
                    
                    <main className="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
                        {/* Key Metrics */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            {performanceData.map((item, idx) => (
                                <div key={idx} className="bg-white rounded-lg shadow p-6">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <p className="text-sm text-gray-600">{item.metric}</p>
                                            <p className="text-2xl font-bold mt-1">{item.value}</p>
                                        </div>
                                        <TrendingUp className={`w-8 h-8 ${item.trend === 'down' || item.metric === 'Incidents Prevented' ? 'text-green-500' : 'text-red-500'} ${item.trend === 'down' && item.metric !== 'Incidents Prevented' ? 'rotate-180' : ''}`} />
                                    </div>
                                    <p className={`text-sm mt-2 ${item.trend === 'down' || item.metric === 'Incidents Prevented' ? 'text-green-600' : 'text-blue-600'}`}>
                                        {item.change} vs last month
                                    </p>
                                </div>
                            ))}
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            {/* Network Map - Fit to aspect ratio */}
                            <div className="lg:col-span-2 bg-white rounded-lg shadow p-6">
                                <h2 className="text-xl font-bold mb-4">Live Network Status</h2>
                                
                                {/* Map aspect ratio fix from before */}
                                <div className="relative bg-gray-100 rounded-lg overflow-hidden">
                                    
                                    <img src="./IIT-3rdWard.jpg" alt="Network Map" className="w-full h-auto" />
                                    
                                    {/* Smaller Static Sensors */}
                                    {sensorData.map((sensor) => (
                                        <div
                                            key={sensor.id}
                                            onClick={() => setSelectedSensor(sensor)}
                                            className="absolute cursor-pointer transform -translate-x-1/2 -translate-y-1/2 z-10"
                                            style={{
                                                left: `${sensor.x}%`,
                                                top: `${sensor.y}%`,
                                            }}
                                        >
                                            <div className={`w-3 h-3 rounded-full ${getStatusColor(sensor.status)} ring-3 ring-white shadow-lg`} />
                                        </div>
                                    ))}

                                    {/* Blinking Work Order Indicators */}
                                    {workOrders.map((order) => (
                                        <div
                                            key={order.id}
                                            className="absolute transform -translate-x-1/2 -translate-y-1/2 z-5 animate-blink"
                                            style={{
                                                left: `${order.x}%`,
                                                top: `${order.y}%`,
                                            }}
                                        >
                                            <AlertTriangle className={`w-6 h-6 ${order.risk === 'critical' ? 'text-red-500' : order.risk === 'high' ? 'text-orange-500' : 'text-yellow-500'}`} />
                                        </div>
                                    ))}

                                    {selectedSensor && (
                                        <div className="absolute bottom-4 left-4 right-4 bg-white rounded-lg shadow-xl p-4 border-2 z-20" style={{borderColor: BRAND_COLORS.primary}}>
                                            <div className="flex justify-between items-start mb-2">
                                                <div>
                                                    <h3 className="font-bold">{selectedSensor.name}</h3>
                                                    <p className="text-sm text-gray-600">{selectedSensor.id}</p>
                                                </div>
                                                <button onClick={() => setSelectedSensor(null)} className="text-gray-400 hover:text-gray-600">✕</button>
                                            </div>
                                            <div className="grid grid-cols-4 gap-4 mt-3">
                                                <div>
                                                    <p className="text-xs text-gray-600">Capacity</p>
                                                    <p className="text-lg font-bold">{selectedSensor.error ? '--' : `${selectedSensor.capacity}%`}</p>
                                                </div>
                                                <div>
                                                    <p className="text-xs text-gray-600">Flow Rate</p>
                                                    <p className="text-lg font-bold">{selectedSensor.error ? '--' : `${selectedSensor.flow} L/s`}</p>
                                                </div>
                                                <div>
                                                    <p className="text-xs text-gray-600">Head Height</p>
                                                    <p className="text-lg font-bold">{selectedSensor.error ? '--' : `${selectedSensor.headHeight} ft`}</p>
                                                </div>
                                                <div>
                                                    <p className="text-xs text-gray-600">Battery</p>
                                                    <p className="text-lg font-bold">{selectedSensor.error ? 'ERROR' : `${selectedSensor.battery}%`}</p>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                <div className="flex items-center justify-center space-x-6 mt-4">
                                    <div className="flex items-center space-x-2">
                                        <div className="w-3 h-3 rounded-full bg-green-500" />
                                        <span className="text-sm text-gray-600">Normal</span>
                                    </div>
                                    <div className="flex items-center space-x-2">
                                        <div className="w-3 h-3 rounded-full bg-yellow-500" />
                                        <span className="text-sm text-gray-600">Warning</span>
                                    </div>
                                    <div className="flex items-center space-x-2">
                                        <div className="w-3 h-3 rounded-full bg-red-500" />
                                        <span className="text-sm text-gray-600">Critical</span>
                                    </div>
                                </div>
                            </div>

                            {/* Priority Work Orders */}
                            <div className="bg-white rounded-lg shadow p-6">
                                <h2 className="text-xl font-bold mb-4 flex items-center">
                                    <AlertTriangle className="w-5 h-5 mr-2 text-orange-500" />
                                    Priority Work Orders
                                </h2>
                                <div className="space-y-3">
                                    {workOrders.map((order) => (
                                        <div key={order.id} className={`border-2 rounded-lg p-3 ${getRiskColor(order.risk)}`}>
                                            <div className="flex justify-between items-start mb-2">
                                                <div>
                                                    <p className="font-bold text-sm">{order.id}</p>
                                                    <p className="text-xs opacity-75">{order.location}</p>
                                                </div>
                                                <span className="text-xs font-semibold uppercase">{order.risk}</span>
                                            </div>
                                            <p className="text-sm font-medium mb-1">{order.issue}</p>
                                            <div className="flex justify-between text-xs mb-2">
                                                <span>Impact: {order.impact}</span>
                                                <span>ETA: {order.eta}</span>
                                            </div>
                                            {order.confidence && (
                                                <>
                                                    <div className="mt-2 bg-gray-200 rounded-full h-1.5">
                                                        <div className="h-1.5 rounded-full" style={{width: `${order.confidence}%`, backgroundColor: BRAND_COLORS.primary}} />
                                                    </div>
                                                    <p className="text-xs text-gray-600 mt-1">Confidence: {order.confidence}%</p>
                                                </>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Historical Trends */}
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                            <div className="bg-white rounded-lg shadow p-6">
                                <SimpleLineChart data={historicalData} />
                            </div>

                            <div className="bg-white rounded-lg shadow p-6">
                                <SimpleBarChart data={historicalData} />
                            </div>
                        </div>

                        {/* Sensor Battery Health Summary - 16 sensors */}
                        <div className="bg-white rounded-lg shadow p-6 mt-6">
                            <h2 className="text-xl font-bold mb-4">Sensor Network Health</h2>
                            <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-4">
                                {sensorData.map((sensor) => (
                                    <div key={sensor.id} className={`p-4 rounded-lg border-2 ${sensor.error ? 'bg-red-50 border-red-300' : sensor.battery < 20 ? 'bg-yellow-50 border-yellow-300' : 'bg-green-50 border-green-300'}`}>
                                        <div className="flex items-center justify-between mb-2">
                                            <p className="font-bold text-sm">{sensor.id}</p>
                                            {sensor.error ? (
                                                <AlertTriangle className="w-5 h-5 text-red-500" />
                                            ) : (
                                                <Battery className={`w-5 h-5 ${sensor.battery > 50 ? 'text-green-500' : sensor.battery > 20 ? 'text-yellow-500' : 'text-red-500'}`} level={sensor.battery} />
                                            )}
                                        </div>
                                        <p className="text-xs text-gray-600 mb-1">{sensor.name}</p>
                                        {sensor.error ? (
                                            <p className="text-sm font-semibold text-red-600">SENSOR ERROR</p>
                                        ) : (
                                            <div>
                                                <p className="text-sm font-semibold">{sensor.battery}%</p>
                                                <div className="mt-1 bg-gray-200 rounded-full h-1.5">
                                                    <div className={`h-1.5 rounded-full ${sensor.battery > 50 ? 'bg-green-500' : sensor.battery > 20 ? 'bg-yellow-500' : 'bg-red-500'}`} style={{width: `${sensor.battery}%`}} />
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        // Flume Landing Page
        const FlumeLanding = ({ user, onLogout }) => {
            return (
                <div className="min-h-screen bg-gray-50">
                    <DashboardHeader user={user} onLogout={onLogout} />
                    
                    <main className="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
                        <div className="bg-white rounded-lg shadow-lg p-12 text-center">
                            <Activity className="w-24 h-24 mx-auto mb-6" style={{color: BRAND_COLORS.primary}} />
                            <h2 className="text-3xl font-bold text-gray-800 mb-4">Flume Lab Sensors</h2>
                            <p className="text-xl text-gray-600 mb-8">Live sensor monitoring coming soon</p>
                            <div className="max-w-2xl mx-auto text-left rounded-lg p-6" style={{backgroundColor: BRAND_COLORS.light}}>
                                <h3 className="font-bold text-lg mb-3" style={{color: BRAND_COLORS.dark}}>Planned Features:</h3>
                                <ul className="space-y-2 text-gray-700">
                                    <li className="flex items-start">
                                        <span className="mr-2" style={{color: BRAND_COLORS.primary}}>•</span>
                                        Real-time sensor data streaming from lab flume
                                    </li>
                                    <li className="flex items-start">
                                        <span className="mr-2" style={{color: BRAND_COLORS.primary}}>•</span>
                                        Live plotting of sensor readings
                                    </li>
                                    <li className="flex items-start">
                                        <span className="mr-2" style={{color: BRAND_COLORS.primary}}>•</span>
                                        Historical data visualization
                                    </li>
                                    <li className="flex items-start">
                                        <span className="mr-2" style={{color: BRAND_COLORS.primary}}>•</span>
                                        Customizable alerts and thresholds
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        // Wabash Landing Page
        const WabashLanding = ({ user, onLogout }) => {
            return (
                <div className="min-h-screen bg-gray-50">
                    <DashboardHeader user={user} onLogout={onLogout} />
                    
                    <main className="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
                        <div className="bg-white rounded-lg shadow-lg p-12 text-center">
                            <Activity className="w-24 h-24 mx-auto mb-6" style={{color: BRAND_COLORS.primary}} />
                            <h2 className="text-3xl font-bold text-gray-800 mb-4">Wabash Sensor Pair</h2>
                            <p className="text-xl text-gray-600 mb-8">Live sensor monitoring coming soon</p>
                            <div className="max-w-2xl mx-auto text-left rounded-lg p-6" style={{backgroundColor: BRAND_COLORS.light}}>
                                <h3 className="font-bold text-lg mb-3" style={{color: BRAND_COLORS.dark}}>Planned Features:</h3>
                                <ul className="space-y-2 text-gray-700">
                                    <li className="flex items-start">
                                        <span className="mr-2" style={{color: BRAND_COLORS.primary}}>•</span>
                                        Real-time data from sensor pair
                                    </li>
                                    <li className="flex items-start">
                                        <span className="mr-2" style={{color: BRAND_COLORS.primary}}>•</span>
                                        Live plotting capabilities
                                    </li>
                                    <li className="flex items-start">
                                        <span className="mr-2" style={{color: BRAND_COLORS.primary}}>•</span>
                                        Data logging and export
                                    </li>
                                    <li className="flex items-start">
                                        <span className="mr-2" style={{color: BRAND_COLORS.primary}}>•</span>
                                        Performance analytics
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const [user, setUser] = useState(null);

            useEffect(() => {
                const savedUser = localStorage.getItem('drainwatch_user');
                if (savedUser) {
                    setUser(JSON.parse(savedUser));
                }
            }, []);

            const handleLogin = (userData) => {
                setUser(userData);
                localStorage.setItem('drainwatch_user', JSON.stringify(userData));
            };

            const handleLogout = () => {
                setUser(null);
                localStorage.removeItem('drainwatch_user');
            };

            if (!user) {
                return <LoginPage onLogin={handleLogin} />;
            }

            switch (user.role) {
                case 'dashboard':
                    return <GraingerDashboard user={user} onLogout={handleLogout} />;
                case 'flume':
                    return <FlumeLanding user={user} onLogout={handleLogout} />;
                case 'wabash':
                    return <WabashLanding user={user} onLogout={handleLogout} />;
                default:
                    return <LoginPage onLogin={handleLogin} />;
            }
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
